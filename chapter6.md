# Chapter 6 - 볼륨 : 컨테이너에 디스크 스토리지 연결 P253 ~296

```
쿠버네티스는 실제 데이터가 있는 디렉토리를 보존하기 위해서 저장소 볼륨을 정의한다. 
포드 같은 최상위 리소스는 아니지만 포드의 일부로 정의되며 포드와 라이프사이클이 같다.

이는 포드가 시작될 때 볼륨이 작성되고 포드가 삭제될 때 볼륨이 삭제됨을 의미한다.
따라서 볼륨의 내용은 컨테이너가 다시 시작될 때까지 유지된다.

컨테이너를 다시 시작하면 새로운 컨테이너는 이전 컨테이너에 의해 볼륨에 기록된 모든 파일을 
볼 수 있다.
또한 포드에 여러 컨테이너가 있는 경우 볼륨을 한꺼번에 모두 사용할 수 있다.
```

## 볼륨 소개
```
쿠버네티스의 볼륨은 포드의 컴포넌트이므로 컨테이너와 마찬가지로 포드의 스펙에 정의된다.
볼륨은 독립적인 쿠버네티스 오브젝트가 아니며 스스로 생성하거나 삭제할 수 없다.

포드의 모든 컨테이너에서 볼륨을 사용할 수 있지만 볼륨에 액세스해야 하는 각 컨테이너에
볼륨을 마운트해야 한다.
각 컨테이너에서 파일 시스템의 임의 위치에 볼륨을 마운트할 수있다.
```

![캡처1](https://user-images.githubusercontent.com/50174803/129390724-185790cb-697e-4fa0-b1da-320ecbce6db5.jpg)
```
동일한 볼륨을 두 컨테이너에서 마운트하면 동일한 파일에서 동작할 수 있다.
위 사진의 경우 세 개의 컨테이너에 두 개의 볼륨을 마운트한다. 이렇게 함으로써, 세 개의 컨테이너는
함께 동작할 수 있고 유용한 작업을 수행할 수 있다.
```

## 사용 가능한 볼륨 유형
```
- emptyDir 
일시적인 데이터를 저장하는데 사용되는 비어있는 단순한 디렉토리

- hostPath
워커노드의 파일 시스템에서 포드로 디렉터리를 마운트하는 데 사용된다.

- nfs
포드에 마운트된 NFS 공유

- persistentvolumeclaim
동적으로 프로비저닝된 영구 스토리지를 사용
```

![캡처2](https://user-images.githubusercontent.com/50174803/129391383-6a83aff1-c489-422c-b7ec-4c95557fb3c5.jpg)

## 영구 스토리지 사용
```
포드에서 실행 중인 애플리케이션이 디스크에 데이터를 유지해야 하고 포드가 다른 노드로 다시
예약된 경우에도 동일한 데이터를 사용할 수 있어야 하는 경우에는 위의 볼륨 유형을 사용할 수 없다.

이 데이터는 모든 클러스터 노드에서 액세스할 수 있어야 하므로 NAS(Network-Attatched Storage) 유형에
저장해야 한다.
```

## 기본 영구 스토리지에서 다른 볼륨의 유형 사용
```
쿠버네티스 클러스터가 아마존의 AWS EC2에서 실행 중인 경우 aws EBS(ElasticBlockStore) 볼륨을
사용해 포드에 영구 저장 공간을 제공할 수 있다.
```

## PersistentVolume & PersistentVolumeClaim 소개
```
애플리케이션이 인프라 세부 사항을 처리하지 않고도 쿠버네티스 클러스터의 스토리지를
요청할 수 있도록 하기 위해 두 가지 리소스가 도입됐다. PV & PVC

개발자가 포드에 기술적으로 세부적인 볼륨을 추가하는 대신, 클러스터 관리자가 
기본 스토리지를 설정한 다음 PV 리소스를 생성해 쿠버네티스 API 서버에 등록한다.
PV를 생성할 때 관리자는 지원하는 액세스 모드와 크기를 지정한다.

클러스터 사용자가 포드 중 하나에서 영구 스토리지를 사용해야 하는 경우 먼저 필요한
최소 크기와 액세스 모드를 지정해 PVC 매니페스트를 생성한다.

그런 다음 사용자가 PVC 매니페스트를 쿠버네티스 API 서버에 제출하고 쿠버네티스가
적절한 영구볼륨을 찾아 클레임에 바인딩한다.

그런 다음 PVC를 포드 내부의 볼륨 중 하나로 사용할 수 있다.
바인딩된 PVC를 삭제해 릴리스될 때까지 다른 사용자는 동일한 PV를 사용할 수 없다.
```
![캡처3](https://user-images.githubusercontent.com/50174803/129392303-ad379fc1-ce89-402c-a8ff-8c05728cfd2c.jpg)
![캡처4](https://user-images.githubusercontent.com/50174803/129392678-e7ae267f-10f2-4d23-a3c9-c052bcd54429.jpg)

## PV & PVC 사용의 장점
```
애플리케이션 개발자에게 인프라에서 스토리지를 가져오는 간접적인 방법을
사용하는 것이 얼마나 간편한 지 고려해보자.

PV & PVC를 생성하는 추가 단계가 필요하지만 개발자는 아래에서 사용되는 실제 스토리지
기술에 대해 알 필요가 없다.

또한 포드의 클레임이 인프라 고유의 것을 사용하지 않기 떄문에 여러 쿠버네티스 클러스터에서
동일한 포드 및 클레임 매니페스트를 사용할 수 있다.

```
![캡처5](https://user-images.githubusercontent.com/50174803/129394308-cdefdad6-3bd9-43e5-bbe4-145db3e06b3c.jpg)


















