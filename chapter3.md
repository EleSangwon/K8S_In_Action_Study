# Chapter3 포드: 쿠버네티스에서 컨테이너 실행하기 P109~ 148

## 파드
```
파드는 컨테이너의 공동의 배포된 그룹이며, 쿠버네티스의 기본 빌딩 블록을 대표

파드의 핵심은 파드에 여러 컨테이너가 포함돼 있을 때 항상 파드 전부가
단일의 워커 노드에서 실행된다는 것이다.
```
![캡처1](https://user-images.githubusercontent.com/50174803/128146239-0a24bf00-a604-499d-b949-db4b99ae1355.jpg)

## 여러 프로세스를 실행할 때 한 개의 컨테이너보다 다수의 컨테이너가 적합한 이유
```
컨테이너는 프로세스 자체가 하위 프로세스를 생성하지 않는 한 컨테이너 당 하나의
프로세스만 실행하도록 설게됐다.

관련 없는 여러 프로세스를 하나의 컨테이너에서 실행하는 경우 모든 프로세스를
실행 상태로 유지하고 로그를 관리하는 것은 사용자의 책임이다.

충돌 발생, 충돌 발생 시 프로세스 자동 시작 매커니즘, 어떤 프로세스가 어떤 내용을 
기록했는 지 등등의 이유 떄문에 각각의 프로세스를 자체 컨테이너에서 실행해야 한다.
```

## 다수의 포드로 멀티티어 애플리케이션 분할하기
```
두 개의 컨테이너가 있는 단일 포드에서 프론트 서버와 DB 모두 실행되도록 할 수 있지만
좋은 방법은 아니다.

둘 다 동일한 포드에 있으면 항상 동일한 시스템에서 실행된다.

+ 여기부터는 책의 말을 나의 말로 풀어씀

쿠버네티스 클러스터 안에 두 개의 노드 A,B가 있다고 하자. 단일 포드 P 에
포론트엔드 컨테이너와 데이터베이스 컨테이너 ( 멀티 컨테이너 )가 있다면 
P는 A 아니면 B 에 스케줄링 될 것이다. 

만약 P를 P1 - 프론트엔트 컨테이너, P2 - 데이터베이스 컨테이너로 분할하면
쿠버네티스는 P1을 노드 A에 배치하고 P2를 노드 B에 배치하므로 
인프라의 활용도가 향상된다.
```

## 각각 스케일링 가능한 파드로 분할하기
```
하나의 파드에 두 가지를 넣지 말아야 하는 또 다른 이유는 스케일링이다.
파드는 스케일링의 기본 단위이다.

쿠버네티스는 개별 컨테이너를 수평으로 스케일아웃할 수 없기 때문에 
전체 포드의 크기를 조정한다.

파드가 프론트 컨테이너 . 백엔드 컨테이너로 구성된 경우 파드 인스턴스 수를
늘리게 되면 두 개의 프론트, 백엔드 컨테이너로 구성된다.
```

![캡처2](https://user-images.githubusercontent.com/50174803/128155366-3e6286d8-8cc2-4868-ad52-9efea4c57586.jpg)

## 명령어 

### 파드 목록에 새로 생성된 파드 보기
```
kubectl get pods 
```

### 애플리케이션 로그 보기
```
kubectl logs <pod-name>
```

### 컨테이너 이름 지정해 다중 컨테이너 파드의 로그 가져오기
```
Pod 의 이름이 sangwon-pod 이고, container 의 이름이 sangwon-container1 인 경우
kubectl logs sangwon-pod -c sangwon-container1
```

### 파드에 요청 보내기 - 포트 포워딩
```
kubectl port-forward sangwon-pod 8080:8080
```

## 라벨
```
쿠버네티스의 모든 리소스를 구성하는 간단하면서도 강력한 쿠버네티스의 기능이다.
라벨은 리소스에 첨부하는 임의의 키/값 쌍이다.

라벨 셀렉터를 사용해 리소스를 선택할 떄 활용된다.
```
![캡처11](https://user-images.githubusercontent.com/50174803/128206555-6336eeed-221e-4e37-8e2b-93607dbe56e0.PNG)

### 라벨 명령어 이용해 포드 탐색
```
kubectl get po --show-labels
```

### 파드에 라벨 설정하기
```
라벨 없는 경우
kubectl label pod sangwon-pod creation_method=manual

기존 라벨 변경
kubectl label pod sangwon-pod env=prod --overwrite
```

## 라벨 셀렉터
```
특정 값의 특정 라벨을 포함하는지 여부에 따라 리소스를 필터링하는 기준이 된다.
```
![캡처22](https://user-images.githubusercontent.com/50174803/128208805-e7fca898-96d4-47ea-b6de-7cd9a07d04eb.PNG)

## 파드 스케줄링 제약을 위한 라벨과 셀렉터의 사용
```
쿠버네티스는 클러스터의 모든 노드를 하나의 대규모 배포 플랫폼으로 노출하기 때문에 
어떤 노드로 파드가 스케줄되는지는 중요하지 않다.

그러나, 파드를 어디로 스케줄링해야 하는지 알려주어야 하는 경우가 있다.

예를 들어, 워커노드 A에 하드 드라이브가 있고 워커노드 B에 SSD가 있는 경우
특정 파드를 A에 나머지는 B에 스케줄링할 수 있다.
```

## 파드에 주석(annotation) 달기
```
라벨 외에도 파드와 그 밖에 객체에 주석을 넣을 수 있다. 주석은 키/값 쌍이므로
라벨과 유사하지만 식별 정보를 보유하지는 않는다.

주석은 라벨보다 훨씬 많은 정보를 담을 수 있으며 주로 도구에서 사용하기 위한 것이다.
```

## 네임스페이스
```
쿠버네티스 네임스페이스는 객체 이름의 범위를 제공한다. 단일 네임스페이스 하나에
모든 리소스를 갖는 대신 여러 개의 네임스페이스로 분할할 수 있으므로, 동일한 리소스 이름을
여러 네임스페이스에서 여러 번 사용할 수 있다.
```

## 네임스페이스의 필요성
```
여러 네임스페이스를 사용하면 많은 구성 요소를 포함하는 복잡한 시스템을 더 작은 그룹으로
분할할 수 있다.

또한 멀티 태넌트 환경에서 리소스를 분리하고 리소르를 생산, 개발 및 QA 환경 또는
필요한 방식으로 분할하는 데 사용할 수 있다.
```

## 라벨 셀렉터로 포드 삭제
```
kubectl delete pod -l rel=canary
```
![캡처33](https://user-images.githubusercontent.com/50174803/128211151-bd27001a-f2d9-4cee-8267-e6fe81977567.PNG)

