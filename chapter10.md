# Chapter10 - 스테이트풀셋 : 복제된 스테이트풀 애플리케이션 배포하기 P419 ~458

## 스테이트풀 포드 복제
```
레플리카셋을 사용해 데이터베이스 포드를 복제할 수 있을까 ? 

레플리카셋은 단일 포드 템플릿에서 여러 포드 복제본을 생성한다. 
복제본은 이름과 IP주소만 다를 뿐 나머지는 똑같다. 

포드 템플릿에 특정 PVC를 참조하는 볼륨이 있으면 레플리카셋의 모든 복제본은 동일한 PVC를
사용하므로 클레임에 바인딩된 동일한 PV를 사용한다.

여러 포드 복제본을 찍어내는 데 사용하는 포드 템플릿에서 PVC를 참조하기 때문에 각 복제본이
고유한 PVC를 사용하도록 설정할 수는 없다. 단일 레플리카셋을 사용한다면 각 인스턴스 자체에 
별도의 스토리지가 필요한 분산 데이터 스토리지도 실행할 수 없다. 
```
![캡1](https://user-images.githubusercontent.com/50174803/132088531-5af064d0-e3cf-414f-bf1f-43992d9e1b0b.jpg)


## 각 포드가 분리된 저장소를 갖도록 여러 복제본 실행
```
한 포드의 복제본을 여러 개 실행하고 각 포드별 자체 스토리지 볼륨을 사용하려면 어떻게 해야 할까 ?
레플리카셋은 포드와 완전히 똑같은 복제본을 만든다. 따라서 이런 유형의 포드에는 사용할 수 없다.
그럼 무엇을 사용할 수 있을까 ?

레플리카셋을 사용해 이런 유형의 포드를 실행하는 대신 스테이트풀셋 리소스를 만든다.
이 리소스는 애플리케이션의 인스턴스가 안정적인 이름과 상태를 가지면서 개별적으로 처리돼야 하는
애플리케이션에 맞게 조정된다.
```

## 스테이트풀셋과 레플리카셋 비교
```
스테이트풀 포드 인스턴스가 종료되거나 노드가 실행 중 장애가 발생하면 다른 노드에서 
포드 인스턴스를 부활시켜야 하지만 새 인스턴스는 교체되는 인스턴스와 동일한 이름, 네트워크ID, 상태를
가져와야 한다.
```
![캡2](https://user-images.githubusercontent.com/50174803/132088742-2fde72eb-c25f-4861-a5e4-4b077384ff72.jpg)

## 스테이트풀셋 스케일링
```
스테이트풀셋을 스케일링하면 사용되지 않는 다음 서수 인덱스를 사용해 새 포드 인스턴스가 생성된다.
두 개에서 세 개 인스턴스로 스케일업하면 새 인스턴스에 인덱스 2가 표시된다.
(기존 인스턴스에 인덱스가 0,1 인 경우)

스테이트풀셋 스케일다운의 좋은 점은 어떤 포드를 제거할 것인지 항상 알 수 있다는 것이다.
따라서 스케일다운 효과를 예측할 수 있다.

```
![캡3](https://user-images.githubusercontent.com/50174803/132088800-ec03b8c6-3322-458b-9f61-2eda025a571d.jpg)
![캡4](https://user-images.githubusercontent.com/50174803/132088939-7ceda6b0-063d-494d-a723-a2805776ac6a.jpg)
![캡5](https://user-images.githubusercontent.com/50174803/132088940-349cf972-611d-44b3-a378-9e09ff7c7911.jpg)
![캡6](https://user-images.githubusercontent.com/50174803/132089039-1462271e-9076-471d-95c0-aacdfeeff743.jpg)


