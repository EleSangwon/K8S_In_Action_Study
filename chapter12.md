# 쿠버네티스 API 서버 보안 P511 ~

```
[ 사용자 ]

쿠버네티스는 API 서버에 접속하는 두 가지 유형의 클라이언트를 구분한다.

* 실제 사람(즉, 사용자)
* 포드(더 구체적으로, 포드 내부에서 실행하는 애플리케이션)

사용자는 SSO (Single Sign On) 시스템과 같은 외부 시스템을 통해 관리하지만
포드에서는 서비스어카운트라는 매커니즘을 사용한다.

이 매커니즘은 클러스터 내에 서비스어카운트 리소스로 생성되고 저장된다.

반면에 사용자 계정을 표현하는 리소스는 없으며 이는 API 서버를 통해 사용자를 생성,
업데이트, 또는 삭제할 수 없다는 의미와 같다.

[ 그룹 ]

사용자 및 서비스어카운트는 모두 하나 이상의 그룹에 속할 수 있다.
각각의 사용자에게 개별적으로 권한을 부여하는 대신 그룹은 그룹에 속한 사용자에게
한 번에 사용 권한을 부여하는 데 사용된다.
```

## 서비스어카운트란
```
포드 내에서 실행되는 애플리케이션이 API 서버 자체와 인증하기 위한 방법이다.

모든 네임스페이스에는 자체 디폴트 서비스어카운트가 포함돼 있지만 필요할 경우 추가할 수있다.
하지만 왜 귀찮게 모든 포드에 디폴트 서비스어카운트를 사용하지 않는걸까 ?

분명한 이유는 클러스터 보안 때문이다. 클러스터 메타 데이터를 읽을 필요가 없는 포드는
클러스터에 배포된 리소스를 검색하거나 수정할 수 없는 제한된 계정에서 실행해야 한다.

리소스 메타 데이터를 검색해야 하는 포드는 해당 객체의 메타 데이터를 읽을 수 있는
서비스 어카운트 아래에서 실행해야 한다.
```

![image](https://user-images.githubusercontent.com/50174803/138428244-8b682bb9-e640-4921-ad94-126be160c010.png)

## RBAC 리소스
```
RBAC 인증 규칙은 네 가지 리소스로 구성되며 두 가지 그룹으로 그룹화할 수 있다.

* 리소스에서 수행할 수 있는 동사를 지정하는 롤 및 클러스터롤
* 위의 롤을 특정 사용자, 그룹 또는 서비스어카운트에 바인딩하는 롤바인딩 및 클러스터롤바인딩

롤과 롤바인딩은 네임스페이스 수준 리소스
클러스터롤과 클러스터롤바인딩은 클러스터 수준 리소스
```
![image](https://user-images.githubusercontent.com/50174803/138555843-57b1a58d-74a4-46a0-9490-27c92934054c.png)

![image](https://user-images.githubusercontent.com/50174803/138555811-bbe53008-0b11-47f1-9640-06d7378784dc.png)

![image](https://user-images.githubusercontent.com/50174803/138555867-f260ba10-09d7-4f2b-93d6-e1e50fe5e914.png)

![image](https://user-images.githubusercontent.com/50174803/138555871-dcec01db-5dcf-4b99-88fc-6f38f39ddcb8.png)

