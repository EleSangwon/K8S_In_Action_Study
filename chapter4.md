# 레플리케이션과 그 밖의 컨트롤러 : 파드 배포 관리 P149 ~

```
파드는 쿠버네티스에서 기본적인 배포가 가능한 유닛이다.

실제환경에서는 배포한 애플리케이션이 자동으로 로드하여 실행되고 
수동으로 개입하지 않아도 정상적으로 안정적 상태를 유지하기를 원할 것이다.

이렇게 하기 위해 수동적으로 파드를 만드는 일은 거의 없다.
대신 디플로이먼트 같은 유형의 리소스를 생성해 실제 파드를 만들고
관리하도록 맡겨둔다.
```

## 파드를 안정적으로 유지하기
```
쿠버네티스를 사용하면 얻을 수 있는 주요 장점 중 하나는 컨테이너 목록을
제공하고 클러스터에서 컨테이너를 계속 실행시킬 수 있다는 것이다.

만약 파드 중 하나가 종료되면 어떻게 될까? 파드의 모든 컨테이너가 종료되면
어떨까?

파드가 노드에 스케줄되자마자 해당 노드의 kubelet 은 컨테이너를 실행하고
파드가 존재하는 한 계속 실행한다.

컨테이너의 주 프로세스에 크래시가 발생하면 kubelet이 컨테이너를 다시 시작한다.

애플리케이션에 버그가 발생하면 쿠버네티스가 자동으로 다시 시작하므로
애플리케이션 자체에 특별한 작업을 하지않아도 쿠버네티스에서 실행 중인
애플리케이션을 자동으로 복구할 수 있다.

크래시가 발생한 컨테이너는 자동으로 다시 시작한다고 했다.
그러나 모든 문제를 해결하지는 못한다.

애플리케이션이 무한 루프 또는 교착 상태에 빠져 응답을 멈추는 상황은 어떨까?
이런 경우 애플리케이션이 다시 시작할 수 있도록 애플리케이션의 상태를
외부에서 체크하도록 하고 내부에서 수행하는 애플리케이션에 의존하지 않아야 한다.
```

## 라이브니스 프로브 
```
쿠버네티스는 라이브니스 프로브를 통해 컨테이너가 아직 살아 있는지 확인할 수 있다.
파드의 사양에서 각 컨테이너에 라이브니스 프로브를 지정할 수 있다.
쿠버네티스는 주기적으로 검사를 실행하고 검사가 실패한 경우 컨테이너를 다시 시작한다.

쿠버네티스는 세 가지 메커니즘 중 하나를 사용해 컨테이너를 검색한다.

- HTTP GET 프로브
지정한 IP주소, 포트, 경로에 HTTP GET 요청을 수행한다.
프로브가 응답을 수신하고 응답 코드가 오류를 나타내지 않으면 프로브는 
성공으로 간주한다.

서버가 오류 응답 코드를 리턴하거나 응답하지 않으면 프로브는 실패로
간주하고 컨테이너를 다시 시작한다.

- TCP 소켓 프로브
컨테이너의 지정된 포트에 TCP 연결을 열려고 시도한다.
성공적으로 연결되면 프로브가 성공한 것이고, 그렇지 않으면
컨테이너를 다시 시작한다.

- EXEC 프로브
컨테이너 내부에 임의의 명령을 실행하고 명령의 종료 상태 코드를
확인한다. 상태 코드가 0이면 검사가 성공이고,
다른 모든 코드는 오류로 간주한다.
```

## HTTP 기반 라이브니스 프로브 생성
```
Node.js 애플리케이션에 라이브니스 프로브를 추가해본다.

웹 애플리케이션이기 때문에 웹 서버가 요청을 처리하는 지 여부를 확인할
라이브니스 프로브를 추가하는 것이 좋다.

```
![캡처44](https://user-images.githubusercontent.com/50174803/128471022-f2effd4b-ef7e-495a-b316-92e3930fa981.jpg)

## 비정상적 컨테이너의 애플리케이션 로그 읽기
```
kubect 
```


